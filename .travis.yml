language: python

services:
  - docker

matrix:
  include:
    - python: 3.7
      dist: xenial
      sudo: true
      env: TOXENV=py37

before_script:
  - cd python
install:
  - pip install tox
script:
  - tox
  - docker build -t csfulop/lbe-rest-pecan .
  - docker run --rm -p 8080:8080 -d --name lbe-rest-pecan csfulop/lbe-rest-pecan
  - timeout 10 bash -c "while ! curl /dev/null http://localhost:8080/; do sleep 1; printf .; done"
  - curl http://localhost:8080/phonebook/
